# Django REST Framework API Documentation

This document provides comprehensive documentation for the messaging platform API implementation using Django REST Framework.

## üìã API Overview

The API provides RESTful endpoints for managing users, conversations, and messages in the messaging platform. All endpoints require authentication and follow REST conventions with proper HTTP status codes.

## üîó Base URL and Versioning

- **Base URL**: `http://localhost:8000/api/`
- **API Version**: v1
- **Documentation**: Available at `/api/docs/`

## üîê Authentication

All API endpoints require authentication using JWT tokens or Django session authentication.

### Login Endpoint
```
POST /api/v1/auth/login/
Content-Type: application/json

{
    "email": "user@example.com",
    "password": "password123"
}
```

Response:
```json
{
    "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

### Token Usage
Include the access token in the Authorization header:
```
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
```

## üë• User Management

### Get Current User Profile
```
GET /api/v1/users/me/
```

**Response (200 OK)**:
```json
{
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "first_name": "John",
    "last_name": "Doe",
    "display_name": "John Doe",
    "phone_number": "+1234567890",
    "role": "host",
    "is_active": true,
    "created_at": "2023-11-17T10:00:00Z"
}
```

### Search Users
```
GET /api/v1/users/?search=john&role=host
```

**Query Parameters**:
- `search`: Search by email, first name, or last name
- `role`: Filter by role (guest, host, admin)

**Response (200 OK)**:
```json
{
    "count": 1,
    "next": null,
    "previous": null,
    "results": [
        {
            "user_id": "550e8400-e29b-41d4-a716-446655440000",
            "email": "john@example.com",
            "first_name": "John",
            "last_name": "Doe",
            "display_name": "John Doe",
            "role": "host",
            "is_active": true
        }
    ]
}
```

## üí¨ Conversation Management

### List User Conversations
```
GET /api/v1/conversations/
```

**Response (200 OK)**:
```json
{
    "count": 2,
    "next": null,
    "previous": null,
    "results": [
        {
            "conversation_id": "550e8400-e29b-41d4-a716-446655440000",
            "title": "Team Chat",
            "participant_count": 3,
            "message_count": 15,
            "created_at": "2023-11-17T10:00:00Z",
            "unread_count": 2,
            "last_message": {
                "message_id": "550e8400-e29b-41d4-a716-446655440001",
                "content": "Hello everyone!",
                "sender": {
                    "user_id": "550e8400-e29b-41d4-a716-446655440002",
                    "first_name": "Jane",
                    "last_name": "Smith",
                    "display_name": "Jane Smith"
                },
                "sent_at": "2023-11-17T10:30:00Z"
            }
        }
    ]
}
```

### Create New Conversation
```
POST /api/v1/conversations/
Content-Type: application/json

{
    "title": "Project Discussion",
    "participant_ids": [
        "550e8400-e29b-41d4-a716-446655440001",
        "550e8400-e29b-41d4-a716-446655440002"
    ]
}
```

**Response (201 Created)**:
```json
{
    "conversation_id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "Project Discussion",
    "participants": [
        {
            "user_id": "550e8400-e29b-41d4-a716-446655440000",
            "email": "user@example.com",
            "first_name": "John",
            "last_name": "Doe",
            "display_name": "John Doe",
            "role": "host"
        }
    ],
    "message_count": 0,
    "created_at": "2023-11-17T10:00:00Z",
    "is_active": true
}
```

### Get Conversation Details
```
GET /api/v1/conversations/{conversation_id}/
```

**Response (200 OK)**:
```json
{
    "conversation_id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "Team Chat",
    "participants": [
        {
            "user_id": "550e8400-e29b-41d4-a716-446655440000",
            "email": "user@example.com",
            "first_name": "John",
            "last_name": "Doe",
            "display_name": "John Doe",
            "role": "host"
        }
    ],
    "admin_participants": [],
    "conversation_admin_participants": [],
    "message_count": 15,
    "last_message": {
        "message_id": "550e8400-e29b-41d4-a716-446655440001",
        "message_body": "Hello everyone!",
        "sender_info": {
            "user_id": "550e8400-e29b-41d4-a716-446655440001",
            "first_name": "Jane",
            "last_name": "Smith",
            "display_name": "Jane Smith"
        },
        "sent_at": "2023-11-17T10:30:00Z",
        "is_deleted": false
    },
    "created_at": "2023-11-17T10:00:00Z",
    "is_active": true
}
```

### Add Participant to Conversation
```
POST /api/v1/conversations/{conversation_id}/add_participant/
Content-Type: application/json

{
    "user_id": "550e8400-e29b-41d4-a716-446655440001"
}
```

**Response (200 OK)**:
```json
{
    "detail": "Participant added successfully."
}
```

### Remove Participant from Conversation
```
POST /api/v1/conversations/{conversation_id}/remove_participant/
Content-Type: application/json

{
    "user_id": "550e8400-e29b-41d4-a716-446655440001"
}
```

**Response (200 OK)**:
```json
{
    "detail": "Participant removed successfully."
}
```

## üí¨ Message Management

### List Conversation Messages
```
GET /api/v1/conversations/{conversation_id}/messages/
```

**Response (200 OK)**:
```json
{
    "count": 10,
    "next": null,
    "previous": null,
    "results": [
        {
            "message_id": "550e8400-e29b-41d4-a716-446655440000",
            "message_body": "Hello everyone! Welcome to our team chat.",
            "sender_info": {
                "user_id": "550e8400-e29b-41d4-a716-446655440001",
                "first_name": "Jane",
                "last_name": "Smith",
                "display_name": "Jane Smith"
            },
            "reply_to_info": null,
            "sent_at": "2023-11-17T10:00:00Z",
            "is_deleted": false
        }
    ]
}
```

### Send New Message
```
POST /api/v1/conversations/{conversation_id}/messages/
Content-Type: application/json

{
    "message_body": "This is a test message to the conversation.",
    "reply_to": "550e8400-e29b-41d4-a716-446655440000"
}
```

**Response (201 Created)**:
```json
{
    "message_id": "550e8400-e29b-41d4-a716-446655440001",
    "message_body": "This is a test message to the conversation.",
    "sender": "550e8400-e29b-41d4-a716-446655440000",
    "conversation": "550e8400-e29b-41d4-a716-446655440002",
    "reply_to": "550e8400-e29b-41d4-a716-446655440000",
    "reply_to_info": {
        "message_id": "550e8400-e29b-41d4-a716-446655440000",
        "content": "Original message content...",
        "sender": {
            "user_id": "550e8400-e29b-41d4-a716-446655440001",
            "first_name": "Jane",
            "last_name": "Smith",
            "display_name": "Jane Smith"
        }
    },
    "sent_at": "2023-11-17T10:30:00Z",
    "is_deleted": false,
    "deleted_at": null,
    "sender_info": {
        "user_id": "550e8400-e29b-41d4-a716-446655440000",
        "first_name": "John",
        "last_name": "Doe",
        "display_name": "John Doe"
    },
    "conversation_info": {
        "conversation_id": "550e8400-e29b-41d4-a716-446655440002",
        "title": "Team Chat",
        "participant_count": 3
    },
    "can_edit": true,
    "can_delete": true
}
```

### Get Individual Message
```
GET /api/v1/messages/{message_id}/
```

**Response (200 OK)**:
```json
{
    "message_id": "550e8400-e29b-41d4-a716-446655440001",
    "message_body": "This is a test message.",
    "sender": "550e8400-e29b-41d4-a716-446655440000",
    "conversation": "550e8400-e29b-41d4-a716-446655440002",
    "reply_to": "550e8400-e29b-41d4-a716-446655440000",
    "reply_to_info": {
        "message_id": "550e8400-e29b-41d4-a716-446655440000",
        "content": "Original message...",
        "sender": {
            "user_id": "550e8400-e29b-41d4-a716-446655440001",
            "first_name": "Jane",
            "last_name": "Smith",
            "display_name": "Jane Smith"
        }
    },
    "sent_at": "2023-11-17T10:30:00Z",
    "is_deleted": false,
    "deleted_at": null,
    "sender_info": {
        "user_id": "550e8400-e29b-41d4-a716-446655440000",
        "first_name": "John",
        "last_name": "Doe",
        "display_name": "John Doe"
    },
    "conversation_info": {
        "conversation_id": "550e8400-e29b-41d4-a716-446655440002",
        "title": "Team Chat",
        "participant_count": 3
    },
    "can_edit": true,
    "can_delete": true
}
```

### Update Message
```
PUT /api/v1/messages/{message_id}/
Content-Type: application/json

{
    "message_body": "Updated message content."
}
```

**Response (200 OK)**:
```json
{
    "message_id": "550e8400-e29b-41d4-a716-446655440001",
    "message_body": "Updated message content.",
    "sender": "550e8400-e29b-41d4-a716-446655440000",
    "conversation": "550e8400-e29b-41d4-a716-446655440002",
    "sent_at": "2023-11-17T10:30:00Z",
    "is_deleted": false,
    "deleted_at": null,
    "sender_info": {
        "user_id": "550e8400-e29b-41d4-a716-446655440000",
        "first_name": "John",
        "last_name": "Doe",
        "display_name": "John Doe"
    },
    "conversation_info": {
        "conversation_id": "550e8400-e29b-41d4-a716-446655440002",
        "title": "Team Chat",
        "participant_count": 3
    },
    "can_edit": true,
    "can_delete": true
}
```

### Delete Message
```
DELETE /api/v1/messages/{message_id}/
```

**Response (200 OK)**:
```json
{
    "detail": "Message deleted successfully."
}
```

### Mark Message as Read
```
POST /api/v1/messages/{message_id}/mark_read/
```

**Response (200 OK)**:
```json
{
    "detail": "Message marked as read."
}
```

## ‚ùå Error Responses

### 400 Bad Request
```json
{
    "detail": "Message content cannot be empty.",
    "errors": {
        "message_body": ["Message content cannot be empty."]
    }
}
```

### 403 Forbidden
```json
{
    "detail": "You are not authorized to access this conversation."
}
```

### 404 Not Found
```json
{
    "detail": "Conversation not found."
}
```

### 409 Conflict
```json
{
    "detail": "User is already a participant in this conversation."
}
```

## üîí Permissions and Access Control

### Role-Based Access
- **Guest**: Limited access, cannot create conversations
- **Host**: Can create conversations, manage their own messages
- **Admin**: Full access, can moderate any conversation

### Conversation Participation
- Only conversation participants can view messages
- Only participants can send messages to the conversation
- Conversation admins can manage participants

### Message Ownership
- Message senders can edit and delete their own messages
- Conversation admins can delete any message in their conversations
- Global admins can delete any message

## üìä Pagination

All list endpoints support pagination using page and page_size query parameters:

```
GET /api/v1/conversations/?page=1&page_size=20
```

**Response includes pagination metadata**:
```json
{
    "count": 100,
    "next": "http://localhost:8000/api/v1/conversations/?page=2",
    "previous": null,
    "results": [...]
}
```

## üîç Filtering and Search

### User Search
```
GET /api/v1/users/?search=john&role=host
```

### Message Filtering
Messages can be filtered by date ranges and sender:
```
GET /api/v1/conversations/{conversation_id}/messages/?sender=550e8400-e29b-41d4-a716-446655440000&start_date=2023-11-01&end_date=2023-11-30
```

## üöÄ API Features

### Comprehensive Validation
- Email uniqueness validation
- Role validation
- Message content validation (non-empty, max 5000 chars)
- Conversation participant validation
- Message sender validation

### Real-time Updates
- Automatic timestamp updates on message creation
- Read receipt tracking
- Conversation activity tracking

### Permission System
- Granular permission checks
- Role-based access control
- Conversation-level permissions
- Message ownership validation

### Error Handling
- Consistent error response format
- Detailed error messages
- Proper HTTP status codes
- Validation error aggregation

### Documentation
- Interactive API documentation available at `/api/docs/`
- OpenAPI/Swagger specification
- ReDoc documentation at `/api/docs/redoc/`

## üõ†Ô∏è Testing the API

### Authentication Test
```bash
# Login
curl -X POST http://localhost:8000/api/v1/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'

# Use the access token for authenticated requests
curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  http://localhost:8000/api/v1/conversations/
```

### Create Conversation
```bash
curl -X POST http://localhost:8000/api/v1/conversations/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title":"Test Chat","participant_ids":["USER_ID_1","USER_ID_2"]}'
```

### Send Message
```bash
curl -X POST http://localhost:8000/api/v1/conversations/CONVERSATION_ID/messages/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"message_body":"Hello World!"}'
```

## üìà Performance Considerations

### Database Optimization
- Efficient query patterns with select_related and prefetch_related
- Proper database indexing for fast lookups
- Optimized pagination for large datasets

### Caching Strategy
- Conversation list caching for better performance
- User profile caching to reduce database load
- Message history caching for active conversations

### Rate Limiting
- API rate limiting to prevent abuse
- Per-user rate limiting
- Different limits for different endpoint types

This API implementation provides a complete, production-ready solution for managing messaging platform interactions with comprehensive validation, security, and performance optimizations.